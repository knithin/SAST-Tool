<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><title>Scan Report</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"></head>
<body>
<div class="container mt-5">
  <h2>🔍 Scan Report</h2>
  {% if git_url %}<p><strong>Repo:</strong> <a href="{{ git_url }}">{{ git_url }}</a></p>{% endif %}
  {% if target_url %}<p><strong>Website:</strong> <a href="{{ target_url }}">{{ target_url }}</a></p>{% endif %}

  <h4>✅ Code Issues:</h4>
  {% if issues %}
  <table class="table table-striped">
    <thead class="table-dark">
      <tr><th>ID</th><th>Severity</th><th>CVSS v3</th><th>Message</th><th>File</th><th>Line</th></tr>
    </thead>
    <tbody>
    {% for i in issues %}
      <tr>
        <td>{{ i.check_id }}</td>
        <td>{{ i.normalized_severity }}</td>
        <td>{{ i.cvss_score }}</td>
        <td>{{ i.extra.message }}</td>
        <td>{{ i.path }}</td>
        <td>{{ i.start.line }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
    <div class="alert alert-success">No code issues detected.</div>
  {% endif %}

  {% if target_url %}
  <h4 class="mt-4">🔐 Website Secrets:</h4>
  {% if website_findings %}
    <table class="table table-bordered">
      <thead class="table-dark"><tr><th>Type</th><th>Match</th><th>URL</th></tr></thead>
      <tbody>
      {% for f in website_findings %}
        <tr><td>{{ f.pattern }}</td><td><code>{{ f.match }}</code></td><td><a href="{{ f.url }}">{{ f.url }}</a></td></tr>
      {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="alert alert-success">No secrets found on the scanned site.</div>
  {% endif %}
  {% endif %}

  <h4 class="mt-4">📄 Raw JSON Output:</h4>
  <pre style="background:#eee;padding:10px;border-radius:4px">{{ raw_log }}</pre>
  <a href="/download_report/{{ report_id }}" class="btn btn-success mt-3">Download Full JSON Report</a>
  <a href="/" class="btn btn-secondary mt-3">Run Another Scan</a>
</div>
</body>
</html>
